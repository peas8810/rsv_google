<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{--bg:#fff;--b:#e5e7eb;--t:#0f172a;--m:#64748b;--m2:#94a3b8;--a:#111827;--badge:#f1f5f9;--sh:0 1px 0 rgba(15,23,42,.04),0 6px 18px rgba(15,23,42,.06);}
    body{margin:0;background:transparent;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    .card{background:var(--bg);border:1px solid var(--b);border-radius:14px;box-shadow:var(--sh);padding:12px 12px 10px;}
    .top{display:flex;justify-content:space-between;align-items:flex-start;gap:10px;margin-bottom:10px;}
    .brand{display:flex;align-items:center;gap:8px;min-width:0;}
    .icon{width:28px;height:28px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(135deg, rgba(17,24,39,.10), rgba(17,24,39,.02));border:1px solid rgba(17,24,39,.14);}
    .title{font-size:13px;font-weight:800;color:var(--t);margin:0;line-height:1.15;}
    .subtitle{margin-top:2px;font-size:10px;font-weight:600;color:var(--m);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:210px;}
    .badge{font-size:10px;font-weight:700;color:var(--m);background:var(--badge);border:1px solid var(--b);padding:4px 8px;border-radius:999px;white-space:nowrap;}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px;margin-bottom:8px;}
    .stat{border:1px solid var(--b);border-radius:12px;padding:8px 10px;background:linear-gradient(180deg,#fff,#fafafa);}
    .k{font-size:10px;font-weight:700;color:var(--m);text-transform:uppercase;letter-spacing:.02em;margin-bottom:3px;}
    .v{font-size:14px;font-weight:800;color:var(--t);line-height:1;}
    .spark{border:1px solid var(--b);border-radius:12px;padding:8px 10px 6px;background:#fff;}
    .sparkHead{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:6px;}
    .sparkLabel{font-size:10px;font-weight:700;color:var(--m);text-transform:uppercase;letter-spacing:.02em;}
    .sparkMini{font-size:10px;font-weight:700;color:var(--m2);white-space:nowrap;}
    canvas{width:100% !important;height:58px !important;}
    .foot{margin-top:8px;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;font-size:10px;color:var(--m2);}
    a{color:inherit;text-decoration:none} a:hover{text-decoration:underline}
  </style>
</head>
<body>

<div class="card">
  <div class="top">
    <div class="brand">
      <div class="icon" aria-hidden="true">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
          <path d="M4 19V5" stroke="rgba(17,24,39,.70)" stroke-width="2" stroke-linecap="round"/>
          <path d="M4 19H20" stroke="rgba(17,24,39,.45)" stroke-width="2" stroke-linecap="round"/>
          <path d="M6.5 15.5L10 12l3 2.2 5-6.2" stroke="rgba(17,24,39,.95)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div>
        <p class="title">Google Scholar</p>
        <div class="subtitle" id="name">Carregando…</div>
      </div>
    </div>
    <div class="badge">RSV</div>
  </div>

  <div class="grid">
    <div class="stat"><div class="k">Citações</div><div class="v" id="c_all">—</div></div>
    <div class="stat"><div class="k">h-index</div><div class="v" id="h_all">—</div></div>
    <div class="stat"><div class="k">i10-index</div><div class="v" id="i10_all">—</div></div>
  </div>

  <div class="spark">
    <div class="sparkHead">
      <div class="sparkLabel">Citações por ano</div>
      <div class="sparkMini" id="last">—</div>
    </div>
    <canvas id="chart"></canvas>
  </div>

  <div class="foot">
    <div>Atualização: <span id="updated">—</span></div>
    <div><a id="link" href="#" target="_blank" rel="noopener">Ver no Scholar</a></div>
  </div>
</div>

<script>
(async function(){
  const URL = "https://raw.githubusercontent.com/peas8810/ojs_google_remunom/main/rsv-scholar.json";
  const $ = (id)=>document.getElementById(id);
  const fmt = (n)=> (n===null||n===undefined||n==="") ? "—" : String(Number(n));

  const res = await fetch(URL + "?t=" + Date.now(), { cache:"no-store" });
  if(!res.ok) throw new Error("HTTP " + res.status);
  const data = await res.json();

  $("name").textContent = data.profile_name ?? "RSV (Google Scholar)";
  $("updated").textContent = data.updated_at ?? "—";
  $("link").href = data.source ?? "https://scholar.google.com/";

  const m = data.metrics || {};
  $("c_all").textContent = fmt(m.citations_all);
  $("h_all").textContent = fmt(m.h_index_all);
  $("i10_all").textContent = fmt(m.i10_index_all);

  const s = Array.isArray(data.citations_by_year) ? data.citations_by_year : [];
  const labels = s.map(x=>x.year);
  const rawVals = s.map(x=>Number(x.value));
  const valid = rawVals.filter(v=>Number.isFinite(v));
  if(!valid.length) return;

  const min = Math.min(...valid), max = Math.max(...valid);
  const pad = (max-min)*0.15 || 1;
  const lastIdx = rawVals.length-1;
  $("last").textContent = `${labels[lastIdx]} • ${rawVals[lastIdx]}`;

  new Chart($("chart"),{
    type:"line",
    data:{labels, datasets:[{
      data: rawVals,
      borderColor:getComputedStyle(document.documentElement).getPropertyValue('--a').trim(),
      borderWidth:2,
      tension:.35,
      fill:false,
      pointRadius:(ctx)=> ctx.dataIndex===lastIdx ? 3.6 : 0,
      pointHoverRadius:5,
      pointBackgroundColor:getComputedStyle(document.documentElement).getPropertyValue('--a').trim(),
      pointBorderWidth:0
    }]},
    options:{
      responsive:true, maintainAspectRatio:false,
      plugins:{legend:{display:false}},
      scales:{x:{display:false}, y:{display:false, min:min-pad, max:max+pad}}
    }
  });
})();
</script>

</body>
</html>
